---
title: "Rad s objektima i podacima, definiranje bioloških varijabli"
author: "Lucija Kanjer"
date: '19.09.2024 '
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Uvod u Tidyverse

   - Tidyverse je skup međusobno povezanih R paketa osmišljenih za olakšavanje rada s podacima.
   - Osnovna filozofija Tidyverse-a je "tidy" (uredan) oblik podataka, gdje su podaci organizirani u tabličnom formatu (redovi predstavljaju opažanja, a stupci varijable).
   - Omogućava intuitivno i efikasno manipuliranje, analiziranje i vizualiziranje podataka.
   - Istovjetne naredbe ponekad su dostupne i u base R-u, ali tidyverse je češće korišten u praksi i pruža puno više mogućnosti za rad s podacima.

### Osnovni paketi u Tidyverse-u

   - __ggplot2__ – Napredna i fleksibilna vizualizacija podataka.
   - __dplyr__ – Efikasna manipulacija podacima (filtriranje, sortiranje, agregacija).
   - __tidyr__ – Transformacija podataka u "tidy" format.
   - readr – Učitavanje podataka iz tekstualnih datoteka (CSV, TSV).
   - tibble – Poboljšani rad s tablicama, alternativa data.frame-u.
   - purrr – Funkcionalno programiranje za rad s listama i iteracijama.
   - stringr – Rad s tekstom i regularnim izrazima.
   - forcats – Rad s kategorijalnim varijablama (faktori).
   - lubridate - Jednostavnija manipulacija datuma i vremena u R-u.

Paketi iz tidyverse-a se mogu učitati svi skupa pomoću naredbe __library(tidyverse)__.

```{r tidyverse}
library(tidyverse)
```
 
 Paket Tidyverse-a se mogu i zasebno učitavati.
 
```{r zasebno}
library(ggplot2)
```
 
## Rad s podacima

   - Za ovu vježbu koristit ćemo set podataka Palmer pengiuns. 
   - Pitanje na koje želimo odgovor je: 

#### __Koja je prosječna težina pingvina vrste Adelie u kilogramima na svakom od otoka?__

```{r učitavanje}
# Učitavanje paketa s podacima o Palmer pingvinima
library(palmerpenguins)

# Učitavanje podataka u R okruženje
data("penguins")

# View(penguins)
```

### Naredba select()

   - Kako bi odgovorili na to pitanje, najlaše je stvroriti novi tablicu u kojoj ćemo __odabrati__ samo one varijable koje su nam potrebne za izračun: species, island i body_mass_g.
   - Naredba __select()__ je funkcija iz dplyr paketa koja služi za odabir (selektiranje) specifičnih stupaca iz data frame-a. Pomaže u fokusiranju samo na one varijable (stupce) koje su potrebne za analizu, a ignorira ostatak podataka.
   
```{r select}
# Odabir (selektiranje) varijabli od interesa
penguins %>%
  select(species, island, body_mass_g)
```

__Pipe operator (%>%) u R-u__ 

   - Pipe operator (%>%) dolazi iz magrittr paketa (dio Tidyverse-a) i koristi se za povezivanje više funkcija na čitljiviji način.
   - Omogućuje prosljeđivanje rezultata iz jedne funkcije kao ulaz u sljedeću funkciju bez potrebe za ugnježđivanjem.
   
Prednosti:
   
   - Čitljivost – Kod je linearan i lakši za razumijevanje.
   - Modularnost – Lako povezivanje različitih operacija bez pretrpavanja.
   - Fleksibilnost – Može se koristiti s većinom funkcija.

```{r}

# Gdje je objekt? Zašto nije u environmentu?
# Kreirajmo novi data frame s kojim možemo manipulirati

adelie <- penguins %>%
  select(species, island, body_mass_g) 

# sad moramo zadržati samo pripadnike vrste Adelie u tablici, funkcija filter
  
adelie <- penguins %>%
  select(species, island, body_mass_g) %>%
  filter(species == "Adelie")

# Želimo da nam masa bude izražena u kg, a ne u gramima
adelie <- penguins %>%
  select(species, island, body_mass_g) %>%
  filter(species == "Adelie") %>%
  mutate(body_mass_kg = body_mass_g/1000)

# Ako želimo da se rezultati prikazuju po otocima, moramo koristiti naredbu group_by()
adelie <- penguins %>%
  select(species, island, body_mass_g) %>%
  filter(species == "Adelie") %>%
  mutate(body_mass_kg = body_mass_g/1000) %>%
  group_by(island)

# Kako bi se prikazao prosjek moramo koristiti naredbu summarise()

adelie <- penguins %>%
  select(species, island, body_mass_g) %>%
  filter(species == "Adelie") %>%
  mutate(body_mass_kg = body_mass_g/1000) %>%
  group_by(island) %>%
  summarise(average_mass = mean(body_mass_kg))

# Zašto nam se ne prikazuju podaci za Torgersen otok?
# jer nismo uklonili nedostajuće vrijednosti!
# koristiti funkciju na.omit()
# Paziti da se koristi na pravome mjestu!

adelie <- penguins %>%
  select(species, island, body_mass_g) %>%
  filter(species == "Adelie") %>%
  mutate(body_mass_kg = body_mass_g/1000) %>%
  na.omit() %>%
  group_by(island) %>%
  summarise(average_mass = mean(body_mass_kg))


```

 