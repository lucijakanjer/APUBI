---
title: "Rad s objektima i podacima, definiranje bioloških varijabli"
author: "Lucija Kanjer"
date: '`r Sys.Date()`'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Uvod u Tidyverse

```{r tidyverse png, echo=FALSE}
knitr::include_graphics("C:/Users/lucij/Documents/APUBI/rmd/tidyverse.png")
#knitr::include_graphics("C:/Users/Hrvoje/Documents/APUBI/rmd/tidyverse.png")
```


   - Tidyverse je skup međusobno povezanih R paketa osmišljenih za olakšavanje rada s podacima.
   - Osnovna filozofija Tidyverse-a je "tidy" (uredan) oblik podataka, gdje su podaci organizirani u tabličnom formatu (redovi predstavljaju opažanja, a stupci varijable).
   - Omogućava intuitivno i efikasno manipuliranje, analiziranje i vizualiziranje podataka.
   - Istovjetne naredbe ponekad su dostupne i u base R-u, ali tidyverse je češće korišten u praksi i pruža puno više mogućnosti za rad s podacima.

### Osnovni paketi u Tidyverse-u

```{r tidyverse packages, echo=FALSE}
knitr::include_graphics("C:/Users/lucij/Documents/APUBI/rmd/tidyverse_packages.png")
#knitr::include_graphics("C:/Users/Hrvoje/Documents/APUBI/rmd/tidyverse_packages.png")
```


   - __ggplot2__ – Napredna i fleksibilna vizualizacija podataka.
   - __dplyr__ – Efikasna manipulacija podacima (filtriranje, sortiranje, agregacija).
   - __tidyr__ – Transformacija podataka u "tidy" format.
   - readr – Učitavanje podataka iz tekstualnih datoteka (CSV, TSV).
   - tibble – Poboljšani rad s tablicama, alternativa data.frame-u.
   - purrr – Funkcionalno programiranje za rad s listama i iteracijama.
   - stringr – Rad s tekstom i regularnim izrazima.
   - forcats – Rad s kategorijalnim varijablama (faktori).
   - lubridate - Jednostavnija manipulacija datuma i vremena u R-u.

Paketi iz tidyverse-a se mogu učitati svi skupa pomoću naredbe __library(tidyverse)__.

```{r tidyverse}
library(tidyverse)
```
 
 Paket Tidyverse-a se mogu i zasebno učitavati.
 
```{r zasebno}
library(ggplot2)
```
 
## Rad s podacima

```{r jpg0, echo=FALSE}
knitr::include_graphics("C:/Users/lucij/Documents/APUBI/rmd/adelie_0.jpg")
#knitr::include_graphics("C:/Users/Hrvoje/Documents/APUBI/rmd/adelie_0.jpg")
```

   - Za ovu vježbu koristit ćemo set podataka Palmer pengiuns. 
   - Pitanje na koje želimo odgovor je: 

#### __"Koja je prosječna masa pingvina vrste Adelie u kilogramima na svakom od otoka?"__

```{r učitavanje}
# Učitavanje paketa s podacima o Palmer pingvinima
library(palmerpenguins)

# Učitavanje podataka u R okruženje
data("penguins")

# View(penguins)
```

### Naredba select()

   - Kako bi odgovorili na to pitanje, najlaše je stvroriti novi tablicu u kojoj ćemo __odabrati__ samo one varijable koje su nam potrebne za izračun: species, island i body_mass_g.
   - Naredba __select()__ je funkcija iz dplyr paketa koja služi za odabir (selektiranje) specifičnih stupaca iz data frame-a. Pomaže u fokusiranju samo na one varijable (stupce) koje su potrebne za analizu, a ignorira ostatak podataka.
   
```{r select}
# Odabir (selektiranje) varijabli od interesa
penguins %>%
  select(species, island, body_mass_g)
```

__Pipe operator (%>%) u R-u__ 

   - Pipe operator (%>%) dolazi iz magrittr paketa (dio Tidyverse-a) i koristi se za povezivanje više funkcija na čitljiviji način.
   - Omogućuje prosljeđivanje rezultata iz jedne funkcije kao ulaz u sljedeću funkciju bez potrebe za ugnježđivanjem.
   
Prednosti:
   
   - Čitljivost – Kod je linearan i lakši za razumijevanje.
   - Modularnost – Lako povezivanje različitih operacija bez pretrpavanja.
   - Fleksibilnost – Može se koristiti s većinom funkcija.

__Gdje je objekt? Zašto nije u environmentu?__

   - Jer ga nismo spremili kao novi objekt!
   - Kreirajmo novi objekt naziva "adelie" u koji će se spremiti izabrane varijable (stupci).
   - Novostvoreni objekt "adelie" preuzima strukturu objekta iz kojeg je stvoren, a to je u ovom slučaju data frame tj. __tibble__ (tidyverse verzija data frame-a).

```{r tibble}
# Spremanje novog data frame-a kao novi objekt "adelie"
adelie <- penguins %>%
  select(species, island, body_mass_g)

# Provjera tipa i strukture objekta
str(adelie)

# View(adelie) ili klik na objekt u environmentu za vizualizaciju nove tablice
```

```{r jpg1, echo=FALSE}
knitr::include_graphics("C:/Users/lucij/Documents/APUBI/rmd/adelie_1.jpg")
#knitr::include_graphics("C:/Users/Hrvoje/Documents/APUBI/rmd/adelie_1.jpg")
```


### Funkcija filter()

  - filter() je funkcija iz dplyr paketa koja služi za filtriranje redova u podatkovnom okviru na temelju uvjeta.
  - Zadržava samo one redove koji zadovoljavaju specificirane uvjete.
  - Čitljivost - Jasno izražava uvjete u kodu.
  - Fleksibilnost - Moguće kombinirati više uvjeta korištenjem logičkih operatora (&, |).
Naredbom filter() želimo od svih redova s vrstama pingvina zadržati samo pripadnike vrste Adelie.

```{r filter}
# filtriramo varijablu "species" da sadržava samo vrijednosti "Adelie"
adelie <- penguins %>%
  select(species, island, body_mass_g) %>%
  filter(species == "Adelie")

# View(adelie) ili klik na objekt u environmentu za vizualizaciju nove tablice
```

```{r jpg2, echo=FALSE}
knitr::include_graphics("C:/Users/lucij/Documents/APUBI/rmd/adelie_2.jpg")
#knitr::include_graphics("C:/Users/Hrvoje/Documents/APUBI/rmd/adelie_2.jpg")
```


### Funkcija mutate() u R-u (dplyr)

  - mutate() je funkcija iz dplyr paketa koja služi za kreiranje novih stupaca (varijabli) ili modifikaciju postojećih unutar data frame-a. 
  - Pomaže u dodavanju izmjenjenih varijabli bez potrebe za kreiranjem novog data frame-a.
  - koristit ćemo funkciju mutate() kako bi kreirali novu varijablu koja prikazuje masu pingvina u kilogramima umjesto u gramima.

```{r mutate}
# Kreiramo novu varijablu "body_mass_kg" tako da staru varijablu "body_mass_g" podijelimo s 1000
adelie <- penguins %>%
  select(species, island, body_mass_g) %>%
  filter(species == "Adelie") %>%
  mutate(body_mass_kg = body_mass_g/1000)

# View(adelie) ili klik na objekt u environmentu za vizualizaciju nove tablice
```

```{r jpg3, echo=FALSE}
knitr::include_graphics("C:/Users/lucij/Documents/APUBI/rmd/adelie_3.jpg")
#knitr::include_graphics("C:/Users/Hrvoje/Documents/APUBI/rmd/adelie_3.jpg")
```


### Funkcija group_by() u R-u (dplyr)

 - group_by() je funkcija iz dplyr paketa koja omogućava grupiranje podataka prema jednoj ili više varijabli. 
 - Koristi se često u kombinaciji s funkcijama poput summarise() za izvođenje agregatnih operacija unutar svake grupe.
 
### Funkcija summarise() u R-u (dplyr)

 - summarise() (ili summarize()) je funkcija iz dplyr paketa koja se koristi za sažimanje podataka na temelju agregatnih operacija. 
- Najčešće se koristi u kombinaciji s group_by() kako bi se izračunale sumarizirane statistike unutar grupa.
 
```{r  group_by summarise}
# Ako želimo da se rezultati prikazuju po otocima, moramo koristiti naredbu group_by()
adelie <- penguins %>%
  select(species, island, body_mass_g) %>%
  filter(species == "Adelie") %>%
  mutate(body_mass_kg = body_mass_g/1000) %>%
  group_by(island)


# Kako bi se prikazao prosjek moramo koristiti naredbu summarise()
# Kreirati novi objekt "adelie_result" samo za nove rezultate
adelie_result <- penguins %>%
  select(species, island, body_mass_g) %>%
  filter(species == "Adelie") %>%
  mutate(body_mass_kg = body_mass_g/1000) %>%
  group_by(island) %>%
  summarise(average_mass = mean(body_mass_kg))

print(adelie_result)

# View(adelie_result) ili klik na objekt u environmentu za vizualizaciju nove tablice
```

```{r jpg4, echo=FALSE}
knitr::include_graphics("C:/Users/lucij/Documents/APUBI/rmd/adelie_4.jpg")
#knitr::include_graphics("C:/Users/Hrvoje/Documents/APUBI/rmd/adelie_4.jpg")
```


__Zašto nam se ne prikazuju podaci za Torgersen otok?__

 - Jer nismo uklonili nedostajuće vrijednosti!
 - Koristiti funkciju na.omit().
 
### Funkcija na.omit() u R-u

 - na.omit() je osnovna R funkcija koja se koristi za __uklanjanje redaka s nedostajućim vrijednostima (NA)__ iz data frame-a ili vektora.
 - Vraća filtrirani data frame bez redaka s NA vrijednostima.
 - Paziti da se koristi na pravome mjestu!
 
```{r na.omit}
# Uklanjanje nedostajućih vrijednosti
adelie_result <- penguins %>%
  select(species, island, body_mass_g) %>%
  filter(species == "Adelie") %>%
  mutate(body_mass_kg = body_mass_g/1000) %>%
  na.omit() %>%
  group_by(island) %>%
  summarise(average_mass = mean(body_mass_kg))

print(adelie_result)

# View(adelie_result) ili klik na objekt u environmentu za vizualizaciju nove tablice

```

```{r jpg5, echo=FALSE}
knitr::include_graphics("C:/Users/lucij/Documents/APUBI/rmd/adelie_5.jpg")
#knitr::include_graphics("C:/Users/Hrvoje/Documents/APUBI/rmd/adelie_5.jpg")
```

__Odgovor na postavljeno pitanje pitanje s početka:__

#### __"Prosječna masa pingvina vrste Adelie na otoku Biscoe i Torgersen iznosila je 3.71 kg, a na otoku Dream 3.69 kg."__

### Zadatak:

 - Koristeći gore naučene funkcije za manipulaciju podacima, kreirajte data frame koji će dati odgovor na pitanje: 
 
#### __"Koja je posječna masa u kilogramima pingvina vrste Gentoo mužjaka, a koja ženki?__
 
```{r jpg00, echo=FALSE}
knitr::include_graphics("C:/Users/lucij/Documents/APUBI/rmd/adelie_00.jpg")
#knitr::include_graphics("C:/Users/Hrvoje/Documents/APUBI/rmd/adelie_00.jpg")
```


#### Rješenje
```{r rjesenje}
# Kreiranje nove tablice "gentoo" sa željenim varijablama "species", "sex", "body_mass_g"
# Filtriranje samo vrste "Gentoo"
# Kreiranje nove varijable za masu u kilogramima
gentoo <- penguins %>%
  select(species, sex, body_mass_g) %>%
  filter(species == "Gentoo") %>%
  mutate(body_mass_kg = body_mass_g/1000)

# Uklanjanje nedostajućih vrijednosti  
# Grupiranje rezultata po spolu
# Sumiranje rezlutata u novu varijablu "average_mass"
gentoo_result <- penguins %>%
  select(species, sex, body_mass_g) %>%
  filter(species == "Gentoo") %>%
  mutate(body_mass_kg = body_mass_g/1000) %>%
  na.omit() %>%
  group_by(sex) %>%
  summarise(average_mass = mean(body_mass_kg))

# Ispis odgovora
print(gentoo_result)

# Odgovor: "Prosječna masa pingvina vrste Gentoo ženki iznosila je 4.68 kg, a mužjaka 5.48 kg."
```

 